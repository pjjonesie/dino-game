<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">

<link rel="stylesheet" href="index.css">

<title>Dino</title>

<style>
html, body {
  margin:0;
  height:100%;
  overflow:hidden;
  background:transparent;
}

/* PRESS SPACE OVERLAY */

#messageBox {
  position:fixed;
  inset:0;
  display:flex;
  align-items:center;
  justify-content:center;
  z-index:9999;
  pointer-events:none;
}

#messageBox h1 {
  font-family:"Arial Black", Arial, sans-serif;
  font-weight:900;
  letter-spacing:-1px;
  transform:scaleX(0.9);
  display:inline-block;
  font-size:42px;
  color:#000;
}
</style>
</head>

<body>

<div id="main-frame-error" class="interstitial-wrapper">
    <div id="runner-container"></div>
</div>

<div id="messageBox">
  <h1>Press Space to Start</h1>
</div>

<script src="index.js"></script>

<script>

/* HIDE PRESS SPACE */

document.onkeydown = function(evt) {
    evt = evt || window.event;
    if (evt.keyCode == 32) {
        var box = document.getElementById("messageBox");
        box.style.visibility="hidden";
    }
};

/* FULL BLEED 1920x1080 SCALE */

function fitDinoToScreen() {

  const canvas = document.querySelector("canvas");
  if (!canvas) return;

  const baseWidth = canvas.width || 600;
  const baseHeight = canvas.height || 150;

  const screenWidth = window.innerWidth;
  const screenHeight = window.innerHeight;

  const scale = Math.max(
    screenWidth / baseWidth,
    screenHeight / baseHeight
  );

  canvas.style.position = "fixed";
  canvas.style.left = "50%";
  canvas.style.top = "50%";
  canvas.style.transformOrigin = "center center";
  canvas.style.transform =
    "translate(-50%, -50%) scale(" + scale + ")";
}

let tries = 0;
let timer = setInterval(function(){

  fitDinoToScreen();
  tries++;

  if (tries > 80) clearInterval(timer);

},50);

window.addEventListener("resize", fitDinoToScreen);

/* FONT PATCH */

(() => {

const FONT = '900 28px "Arial Black", Arial, sans-serif';
const BIGFONT = '900 46px "Arial Black", Arial, sans-serif';
const CONDENSE = 0.84;

function shouldStyleText(txt) {

  if (!txt) return false;
  txt = String(txt);

  if (/^\d+$/.test(txt)) return true;
  if (/HI/.test(txt)) return true;
  if (/GAME OVER/i.test(txt)) return true;

  return false;
}

const proto = CanvasRenderingContext2D.prototype;
const original = proto.fillText;

proto.fillText = function(text, x, y, maxWidth) {

  if (!shouldStyleText(text)) {
    return original.call(this, text, x, y, maxWidth);
  }

  let big = /GAME OVER/i.test(text);

  this.save();
  this.scale(CONDENSE, 1);

  let newX = x / CONDENSE;

  this.font = big ? BIGFONT : FONT;
  this.fillStyle = "#000";

  let result = original.call(this, text, newX, y, maxWidth);

  this.restore();
  return result;
}

})();
</script>

</body>
</html>

